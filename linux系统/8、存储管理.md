# 8、存储管理

## 查看磁盘信息

### `ll /dev/sd*`
```shell script
[root@localhost ~]# ls -l /dev/sd*
brw-rw----. 1 root disk 8,  0 Dec  3 21:51 /dev/sda
brw-rw----. 1 root disk 8,  1 Dec  3 21:51 /dev/sda1
brw-rw----. 1 root disk 8,  2 Dec  3 21:51 /dev/sda2
brw-rw----. 1 root disk 8, 16 Dec  3 21:51 /dev/sdb


```

### `lsblk`

```shell script
[root@localhost ~]# lsblk 
NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda           8:0    0   20G  0 disk 
├─sda1        8:1    0    1G  0 part /boot
└─sda2        8:2    0   19G  0 part 
  ├─cs-root 253:0    0   17G  0 lvm  /
  └─cs-swap 253:1    0    2G  0 lvm  [SWAP]
sdb           8:16   0   20G  0 disk 
sr0          11:0    1  788M  0 rom  /run/media/root/CentOS-Stream-8-x86_64-dvd
```

## 创建分区

### `fsisk`

```shell script
[root@localhost ~]# fdisk /dev/sdb 

Welcome to fdisk (util-linux 2.32.1).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.

Device does not contain a recognized partition table.
Created a new DOS disklabel with disk identifier 0xe3c113e1.

Command (m for help): m

Help:

  DOS (MBR)
   a   toggle a bootable flag
   b   edit nested BSD disklabel
   c   toggle the dos compatibility flag

  Generic
   d   delete a partition
   F   list free unpartitioned space
   l   list known partition types
   n   add a new partition
   p   print the partition table
   t   change a partition type
   v   verify the partition table
   i   print information about a partition

  Misc
   m   print this menu
   u   change display/entry units
   x   extra functionality (experts only)

  Script
   I   load disk layout from sfdisk script file
   O   dump disk layout to sfdisk script file

  Save & Exit
   w   write table to disk and exit
   q   quit without saving changes

  Create a new label
   g   create a new empty GPT partition table
   G   create a new empty SGI (IRIX) partition table
   o   create a new empty DOS partition table
   s   create a new empty Sun partition table


Command (m for help): n
Partition type
   p   primary (0 primary, 0 extended, 4 free)
   e   extended (container for logical partitions)
Select (default p): p
Partition number (1-4, default 1): 1
First sector (2048-41943039, default 2048): 
Last sector, +sectors or +size{K,M,G,T,P} (2048-41943039, default 41943039): 

Created a new partition 1 of type 'Linux' and of size 20 GiB.

Command (m for help): w
The partition table has been altered.
Calling ioctl() to re-read partition table.
Syncing disks.

[root@localhost ~]# 

```

## 刷新分区

```shell script
[root@localhost ~]# partprobe /dev/sdb

```

## 查看分区

```shell script
[root@localhost ~]# fdisk -l /dev/sdb
Disk /dev/sdb: 20 GiB, 21474836480 bytes, 41943040 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0xe3c113e1

Device     Boot Start      End  Sectors Size Id Type
/dev/sdb1        2048 41943039 41940992  20G 83 Linux

```

```shell script
[root@localhost ~]# lsblk 
NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda           8:0    0   20G  0 disk 
├─sda1        8:1    0    1G  0 part /boot
└─sda2        8:2    0   19G  0 part 
  ├─cs-root 253:0    0   17G  0 lvm  /
  └─cs-swap 253:1    0    2G  0 lvm  [SWAP]
sdb           8:16   0   20G  0 disk 
└─sdb1        8:17   0   20G  0 part 
sr0          11:0    1  788M  0 rom  /run/media/root/CentOS-Stream-8-x86_64-dvd

```

## 创建文件系统（格式化）

```shell script
[root@localhost ~]# mkfs.ext4 /dev/sdb1 
mke2fs 1.45.6 (20-Mar-2020)
Creating filesystem with 5242624 4k blocks and 1310720 inodes
Filesystem UUID: 88814f05-50d4-433f-9345-0e63129510ec
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
	4096000

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information: done   
```

## 挂载磁盘

```shell script
[root@localhost ~]# mount -t ext4 /dev/sdb1 /mnt/disk1/
[root@localhost ~]# df -hT
Filesystem          Type      Size  Used Avail Use% Mounted on
devtmpfs            devtmpfs  1.8G     0  1.8G   0% /dev
tmpfs               tmpfs     1.9G     0  1.9G   0% /dev/shm
tmpfs               tmpfs     1.9G  9.8M  1.9G   1% /run
tmpfs               tmpfs     1.9G     0  1.9G   0% /sys/fs/cgroup
/dev/mapper/cs-root xfs        17G  5.1G   12G  30% /
/dev/sda1           xfs      1014M  254M  761M  26% /boot
tmpfs               tmpfs     371M   32K  371M   1% /run/user/0
/dev/sr0            iso9660   788M  788M     0 100% /run/media/root/CentOS-Stream-8-x86_64-dvd
/dev/sdb1           ext4       20G   45M   19G   1% /mnt/disk1

```

## 扩展分区

### 查看分区信息（目前没有扩展分区，只有一个20G主分区）

```
Command (m for help): p
Disk /dev/sdb: 20 GiB, 21474836480 bytes, 41943040 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0xe3c113e1

Device     Boot Start      End  Sectors Size Id Type
/dev/sdb1        2048 41943039 41940992  20G 83 Linux

```

### 删除分区

```shell script
Command (m for help): d
Selected partition 1
Partition 1 has been deleted.

```

### 新建扩展分区

```shell script
[root@localhost ~]# fdisk -l
Disk /dev/sdb: 20 GiB, 21474836480 bytes, 41943040 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0xe3c113e1

Device     Boot    Start      End  Sectors Size Id Type
/dev/sdb1           2048 20973567 20971520  10G 83 Linux
/dev/sdb2       20973568 25167871  4194304   2G 83 Linux
/dev/sdb3       25167872 29362175  4194304   2G 83 Linux
/dev/sdb4       29362176 41943039 12580864   6G  5 Extended


Disk /dev/sda: 20 GiB, 21474836480 bytes, 41943040 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x5116c48d

Device     Boot   Start      End  Sectors Size Id Type
/dev/sda1  *       2048  2099199  2097152   1G 83 Linux
/dev/sda2       2099200 41943039 39843840  19G 8e Linux LVM


Disk /dev/mapper/cs-root: 17 GiB, 18249416704 bytes, 35643392 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes


Disk /dev/mapper/cs-swap: 2 GiB, 2147483648 bytes, 4194304 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

```
### 新建逻辑分区

```shell script
Welcome to fdisk (util-linux 2.32.1).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.


Command (m for help): p
Disk /dev/sdb: 20 GiB, 21474836480 bytes, 41943040 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0xe3c113e1

Device     Boot    Start      End  Sectors Size Id Type
/dev/sdb1           2048 20973567 20971520  10G 83 Linux
/dev/sdb2       20973568 25167871  4194304   2G 83 Linux
/dev/sdb3       25167872 29362175  4194304   2G 83 Linux
/dev/sdb4       29362176 41943039 12580864   6G  5 Extended

```

### 逻辑分区5，6，7

```shell script
[root@localhost ~]# fdisk /dev/sdb

Welcome to fdisk (util-linux 2.32.1).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.


Command (m for help): n
All primary partitions are in use.
Adding logical partition 5
First sector (29364224-41943039, default 29364224): 
Last sector, +sectors or +size{K,M,G,T,P} (29364224-41943039, default 41943039): +200M

Created a new partition 5 of type 'Linux' and of size 200 MiB.

Command (m for help): n
All primary partitions are in use.
Adding logical partition 6
First sector (29775872-41943039, default 29775872): 
Last sector, +sectors or +size{K,M,G,T,P} (29775872-41943039, default 41943039): +200M

Created a new partition 6 of type 'Linux' and of size 200 MiB.

```

### 查看逻辑分区

```shell script
[root@localhost ~]# fdisk /dev/sdb -l
Disk /dev/sdb: 20 GiB, 21474836480 bytes, 41943040 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0xe3c113e1

Device     Boot    Start      End  Sectors  Size Id Type
/dev/sdb1           2048 20973567 20971520   10G 83 Linux
/dev/sdb2       20973568 25167871  4194304    2G 83 Linux
/dev/sdb3       25167872 29362175  4194304    2G 83 Linux
/dev/sdb4       29362176 41943039 12580864    6G  5 Extended
/dev/sdb5       29364224 29773823   409600  200M 83 Linux
/dev/sdb6       29775872 30185471   409600  200M 83 Linux

```

```shell script
[root@localhost ~]# lsblk 
NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda           8:0    0   20G  0 disk 
├─sda1        8:1    0    1G  0 part /boot
└─sda2        8:2    0   19G  0 part 
  ├─cs-root 253:0    0   17G  0 lvm  /
  └─cs-swap 253:1    0    2G  0 lvm  [SWAP]
sdb           8:16   0   20G  0 disk 
├─sdb1        8:17   0   10G  0 part 
├─sdb2        8:18   0    2G  0 part 
├─sdb3        8:19   0    2G  0 part 
├─sdb4        8:20   0    1K  0 part 
├─sdb5        8:21   0  200M  0 part 
└─sdb6        8:22   0  200M  0 part 
sr0          11:0    1  788M  0 rom  /run/media/root/CentOS-Stream-8-x86_64-dvd
```