# 12、日志管理

## 日志进程`rsyslog`

### 查看日志进程

```shell
[root@CentOs8 xm]# ps aux | grep rsyslogd
root        1106  0.0  1.7 766640 30660 ?        Ssl  6月23  12:42 /usr/sbin/rsyslogd -n
root     3393878  0.0  0.0  12348  1080 pts/0    S+   17:02   0:00 grep --color=auto rsyslogd
```

### 常见日志文件

```shell
# 查看日志
[root@CentOs8 log]# pwd
/var/log
[root@CentOs8 log]# ls
anaconda           btmp                   cron             dnf.librepo.log-20210530  dnf.log.2                     hawkey.log           jenkins           maillog-20211205   messages-20211212  sa               secure-20211212   sssd
audit              btmp-20211201          cron-20211121    dnf.librepo.log-20210606  dnf.log.3                     hawkey.log-20210627  journal           maillog-20211212   mongodb            samba            spooler           tuned
boot.log           chrony                 cron-20211128    dnf.librepo.log-20210613  dnf.log.4                     hawkey.log-20210704  lastlog           messages           mysql              secure           spooler-20211121  wtmp
boot.log-20210307  cloudinit-deploy.log   cron-20211205    dnf.librepo.log-20210620  dnf.rpm.log                   hawkey.log-20211209  maillog           messages-20211121  nginx              secure-20211121  spooler-20211128
boot.log-20210618  cloud-init.log         cron-20211212    dnf.log                   ecs_network_optimization.log  hawkey.log-20211212  maillog-20211121  messages-20211128  php-fpm            secure-20211128  spooler-20211205
boot.log-20210624  cloud-init-output.log  dnf.librepo.log  dnf.log.1                 firewalld                     httpd                maillog-20211128  messages-20211205  private            secure-20211205  spooler-20211212

# 监听日志，发生变化会更新
[root@CentOs8 log]# tail -f ./messages
Dec 13 17:14:14 CentOs8 crond[1121]: No configuration file found at /root/.esmtprc or /etc/esmtprc
Dec 13 17:14:14 CentOs8 crond[1121]: No configuration file found at /root/.esmtprc or /etc/esmtprc
Dec 13 17:14:14 CentOs8 crond[1121]: No configuration file found at /root/.esmtprc or /etc/esmtprc
Dec 13 17:14:14 CentOs8 crond[1121]: No configuration file found at /root/.esmtprc or /etc/esmtprc

```

## 配置

### `rpm -qc rsyslog`查看配置文件

```shell
[root@CentOs8 log]# rpm -qc rsyslog
/etc/logrotate.d/syslog
/etc/rsyslog.conf
/etc/sysconfig/rsyslog

[root@CentOs8 ~]# grep Facility /etc/ssh/sshd_config
#SyslogFacility AUTH
SyslogFacility AUTHPRIV
```
### `RULES`

**`-`异步处理`-/var/log/maillog`**

```text
authpriv.*          /var/log/secure(SSH信息)
mail.*              -/var/log/maillog(发邮件)
cron.*              /var/log/cron(创建任务)
```

```shell
# Log anything (except mail) of level info or higher.
# Don't log private authentication messages!
*.info;mail.none;authpriv.none;cron.none                /var/log/messages

# The authpriv file has restricted access.
authpriv.*                                              /var/log/secure

# Log all the mail messages in one place.
mail.*                                                  -/var/log/maillog


# Log cron stuff
cron.*                                                  /var/log/cron

# Everybody gets emergency messages
*.emerg                                                 :omusrmsg:*

# Save news errors of level crit and higher in a special file.
uucp,news.crit                                          /var/log/spooler

# Save boot messages also to boot.log
local7.*                                                /var/log/boot.log
```


## 日志轮转`logrotate`